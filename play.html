<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Candy Match - Play</title>

<link rel="stylesheet" href="css/style.css">

<style>
/* ---------- card layout (page) ---------- */
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(180deg,#ffeef5,#f4f9ff);
  display: flex;
  justify-content: center;
}

.card {
  max-width: 720px;
  margin: 18px auto;
  padding: 26px;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 14px 36px rgba(8,20,40,0.06);
  overflow: hidden;
  position: relative;
}

.stats-row {
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  align-items:center;
  margin-bottom: 18px;
  justify-content:flex-start;
}
.stat {
  background:#fff;
  padding:12px 18px;
  border-radius:14px;
  box-shadow: 0 8px 20px rgba(10,20,40,0.06);
  font-weight:600;
}

.game-grid-container {
  display:flex;
  justify-content:center;
  width:100%;
  overflow:hidden;
  padding-bottom: 8px;
}

.game-grid {
  display: grid;
  grid-template-columns: repeat(var(--cols, 7), 1fr);
  gap: 12px;
  justify-content: center;
  width: min(92%, 680px);
  touch-action: none;
  padding: 6px;
  box-sizing: border-box;
}

.game-grid .cell {
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 12px;
  background: linear-gradient(180deg,#fff,#fcfcfd);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow: 0 10px 22px rgba(10,20,40,0.06);
  position: relative;
  user-select: none;
  -webkit-user-drag: none;
  overflow: visible;
  transition: transform 0.18s ease, box-shadow 0.12s;
}

.game-grid .cell img {
  width: 78%;
  height: 78%;
  object-fit: contain;
  pointer-events: none;
  -webkit-user-drag: none;
  transition: transform 0.12s ease, opacity 0.15s;
}

.cell.swapping { transform: scale(0.96); box-shadow: 0 8px 26px rgba(0,0,0,0.12); }
.cell.invalid { animation: shake .18s; }
@keyframes shake {
  0%{ transform: translateX(0); }
  25%{ transform: translateX(-6px); }
  50%{ transform: translateX(6px); }
  75%{ transform: translateX(-3px); }
  100%{ transform: translateX(0); }
}

.dragging-clone {
  position: fixed;
  z-index: 9999;
  width: 52px;
  height: 52px;
  transform: translate(-50%, -50%);
  pointer-events: none;
  transition: transform 0.06s linear;
}

@media (max-width:520px){
  .card { padding:18px; border-radius:12px; margin:14px; }
  .game-grid { gap:10px; width: calc(100% - 32px); }
  .game-grid .cell img { width:84%; height:84%; }
  .stat { padding:10px 14px; }
}

.game-bottom-space { height: 22px; }
</style>
</head>

<body>

<div id="gameCard" class="card">
  <a href="map.html" style="text-decoration:none;color:#6a48c6;">‚Üê Map</a>
  <h1>Level 1</h1>

  <div class="stats-row">
    <div class="stat">Score: <span id="score">0</span></div>
    <div class="stat">Moves: <span id="moves">30</span></div>
    <div class="stat">Target: <span id="target">600</span></div>
    <div class="stat">Timer: <span id="timer">--:--</span></div>
  </div>

  <div class="game-grid-container">
    <div id="gameGrid" class="game-grid"></div>
  </div>

  <div class="game-bottom-space"></div>

  <div style="display:flex;gap:12px;justify-content:center;margin-top:16px">
    <button id="btnRestart">Restart</button>
    <button id="btnEnd">End</button>
  </div>
</div>

<!-- Optional sound file -->
<script src="js/sound.js"></script>

<!-- Responsive grid helper -->
<script>
(function setupResponsiveGrid(){
  const gridId = 'gameGrid';
  function computeColsFor(gridEl){
    const minCell = 56;
    const gap = 12;
    const maxCols = 8;
    const minCols = 5;
    const container = Math.min(gridEl.getBoundingClientRect().width || window.innerWidth * 0.92, 680);
    let cols = Math.floor((container + gap) / (minCell + gap));
    cols = Math.max(minCols, Math.min(maxCols, cols));
    gridEl.style.setProperty('--cols', cols);
    gridEl.dataset.cols = cols;
    return cols;
  }
  function computeCols(){
    const el = document.getElementById(gridId);
    if(el) computeColsFor(el);
  }
  if(document.readyState !== 'loading'){ computeCols(); }
  else { document.addEventListener('DOMContentLoaded', computeCols); }
  let t;
  window.addEventListener('resize', ()=> { clearTimeout(t); t = setTimeout(computeCols, 120); });
})();
</script>

<!-- Game Core logic -->
<script src="js/game-core.js"></script>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const lvl = parseInt(new URLSearchParams(location.search).get('level') || '1', 10);
  if(typeof Game !== 'undefined' && Game.start) {
    Game.start(lvl);
  }
  document.getElementById('btnRestart').onclick = ()=> Game.restart();
  document.getElementById('btnEnd').onclick = ()=> alert("Game Ended!");
});
</script>

</body>
  </html>
