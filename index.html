<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Candy Match Game üç¨</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#ffe6f0,#fff9fc);
  min-height:100vh;display:flex;justify-content:center;align-items:center;
  overflow:hidden;
}
button{cursor:pointer;transition:all 0.3s ease;}
.hidden{display:none;}
.container{
  width:100%;max-width:420px;background:white;border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
  padding:20px;text-align:center;position:relative;
}

/* ---------- HOME SCREEN ---------- */
#homeScreen button{
  width:80%;margin:10px;padding:14px;border:none;border-radius:30px;
  font-weight:600;color:white;font-size:18px;
}
#startBtn{background:linear-gradient(135deg,#ff4081,#ff80ab);}
#shopBtn{background:linear-gradient(135deg,#42a5f5,#1976d2);}
#aboutBtn{background:linear-gradient(135deg,#4caf50,#2e7d32);}
h1{
  color:#ff4081;
  margin-bottom:15px;
  text-shadow:1px 1px 2px rgba(0,0,0,0.1);
}

/* ---------- GAME SCREEN ---------- */
#gameScreen{
  display:none;flex-direction:column;align-items:center;justify-content:center;
}
.hud{
  display:flex;justify-content:space-between;align-items:center;
  width:100%;background:#fff4f8;padding:10px 20px;border-radius:15px;
  margin-bottom:10px;font-weight:600;color:#ff4081;
}
.grid{
  display:grid;grid-template-columns:repeat(8,1fr);gap:3px;
  background:#ffecf3;padding:8px;border-radius:15px;
}
.cell{
  width:42px;height:42px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1);
  transition:transform 0.2s;
}
.cell img{width:90%;height:90%;object-fit:contain;pointer-events:none;}
.cell.pop{animation:pop 0.5s ease forwards;}
@keyframes pop{
  0%{transform:scale(1);opacity:1}
  50%{transform:scale(1.4);opacity:0.8}
  100%{transform:scale(0);opacity:0}
}
.controls{margin-top:15px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
.controls button{
  padding:10px 20px;border:none;border-radius:20px;
  background:linear-gradient(135deg,#ff4081,#ff80ab);
  color:white;font-weight:600;font-size:14px;
}

/* ---------- SHOP SCREEN ---------- */
#shopScreen{
  display:none;text-align:center;
}
.shop-item{
  display:flex;justify-content:space-between;align-items:center;
  background:#fff4f8;border-radius:12px;padding:10px;margin:8px 0;
}
.shop-item button{
  background:linear-gradient(135deg,#42a5f5,#1976d2);
  color:white;border:none;padding:6px 12px;border-radius:10px;font-weight:600;
}
.backBtn{
  margin-top:15px;padding:10px 20px;background:#ff4081;color:white;
  border:none;border-radius:20px;font-weight:600;
}
@media(max-width:480px){
  .cell{width:36px;height:36px;}
}
</style>
</head>
<body>
<div class="container">

  <!-- HOME SCREEN -->
  <div id="homeScreen">
    <h1>üç≠ Candy Match</h1>
    <button id="startBtn">Start Game</button>
    <button id="shopBtn">Shop</button>
    <button id="aboutBtn">About</button>
  </div>

  <!-- GAME SCREEN -->
  <div id="gameScreen">
    <div class="hud">
      <div>Score: <span id="score">0</span></div>
      <div>Moves: <span id="moves">30</span></div>
      <div>Combo: <span id="combo">1x</span></div>
    </div>

    <div id="grid" class="grid"></div>
    <div class="controls">
      <button id="restartBtn">Restart</button>
      <button id="hintBtn">Hint</button>
      <button id="homeBtn">Home</button>
    </div>
  </div>

  <!-- SHOP SCREEN -->
  <div id="shopScreen">
    <h2>üõí Candy Shop</h2>
    <div class="shop-item"><span>Extra Moves</span><button>Buy</button></div>
    <div class="shop-item"><span>Bomb Booster</span><button>Buy</button></div>
    <div class="shop-item"><span>Rainbow Candy</span><button>Buy</button></div>
    <button class="backBtn" id="shopBack">‚¨Ö Back</button>
  </div>

</div>

<script>
const WIDTH=8,HEIGHT=8,SIZE=WIDTH*HEIGHT;
const IMAGE_BASE='images/';
const CANDIES=['candy1.png','candy2.png','candy3.png','candy4.png','candy5.png','candy6.png','candy7.png','candy8.png'];
let pool=[];
let board=[];
let score=0,moves=30,combo=1;
let selected=null,isSwapping=false;

/* --- Screen Controls --- */
const homeScreen=document.getElementById('homeScreen');
const gameScreen=document.getElementById('gameScreen');
const shopScreen=document.getElementById('shopScreen');

document.getElementById('startBtn').onclick=()=>{homeScreen.style.display='none';gameScreen.style.display='flex';initGame();};
document.getElementById('homeBtn').onclick=()=>{gameScreen.style.display='none';homeScreen.style.display='block';};
document.getElementById('shopBtn').onclick=()=>{homeScreen.style.display='none';shopScreen.style.display='block';};
document.getElementById('shopBack').onclick=()=>{shopScreen.style.display='none';homeScreen.style.display='block';};
document.getElementById('aboutBtn').onclick=()=>alert("üéÆ Candy Match\nMatch 3 candies to score points!\nSwipe or tap to swap candies.");

async function preload(){
  pool=await Promise.all(CANDIES.map(async n=>{
    const url=IMAGE_BASE+n;
    const img=new Image();
    return new Promise(res=>{
      img.onload=()=>res(url);
      img.onerror=()=>res('');
      img.src=url;
    });
  }));
  pool=pool.filter(Boolean);
}

/* --- Game Logic --- */
function initGame(){
  score=0;moves=30;combo=1;selected=null;
  board=new Array(SIZE).fill(null).map(()=>({src:pool[Math.floor(Math.random()*pool.length)]}));
  render();
  updateHUD();
}

function render(){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  board.forEach((tile,i)=>{
    const div=document.createElement('div');
    div.className='cell';
    div.dataset.index=i;
    const img=document.createElement('img');
    img.src=tile.src;
    div.appendChild(img);
    div.onclick=()=>handleSelect(i);
    grid.appendChild(div);
  });
}

function handleSelect(i){
  if(isSwapping)return;
  if(selected===null){selected=i;highlight(i);}
  else if(selected===i){unhighlight(i);selected=null;}
  else if(isAdjacent(selected,i)){
    swap(selected,i);
    unhighlight(selected);
    selected=null;
  }else{
    unhighlight(selected);
    selected=i;highlight(i);
  }
}

function highlight(i){document.querySelector(`[data-index="${i}"]`).style.transform='scale(0.9)';}
function unhighlight(i){document.querySelector(`[data-index="${i}"]`).style.transform='scale(1)';}

function isAdjacent(a,b){
  const r1=Math.floor(a/WIDTH),c1=a%WIDTH,r2=Math.floor(b/WIDTH),c2=b%WIDTH;
  return Math.abs(r1-r2)+Math.abs(c1-c2)===1;
}

function swap(a,b){
  isSwapping=true;
  [board[a],board[b]]=[board[b],board[a]];
  render();
  setTimeout(()=>{
    const matches=findMatches();
    if(matches.length>0){
      handleMatches(matches);
    }else{
      [board[a],board[b]]=[board[b],board[a]];
      render();
    }
    moves--;updateHUD();
    isSwapping=false;
  },200);
}

function findMatches(){
  const matches=[];
  for(let r=0;r<HEIGHT;r++){
    for(let c=0;c<WIDTH-2;c++){
      const i=r*WIDTH+c;
      if(board[i]&&board[i+1]&&board[i+2]&&board[i].src===board[i+1].src&&board[i].src===board[i+2].src)
        matches.push(i,i+1,i+2);
    }
  }
  for(let c=0;c<WIDTH;c++){
    for(let r=0;r<HEIGHT-2;r++){
      const i=r*WIDTH+c;
      if(board[i]&&board[i+WIDTH]&&board[i+2*WIDTH]&&board[i].src===board[i+WIDTH].src&&board[i].src===board[i+2*WIDTH].src)
        matches.push(i,i+WIDTH,i+2*WIDTH);
    }
  }
  return [...new Set(matches)];
}

function handleMatches(matches){
  score+=matches.length*10*combo;
  combo++;
  matches.forEach(i=>{
    const el=document.querySelector(`[data-index="${i}"]`);
    if(el)el.classList.add('pop');
    board[i]=null;
  });
  setTimeout(()=>{applyGravity();},400);
}

function applyGravity(){
  for(let c=0;c<WIDTH;c++){
    const col=[];
    for(let r=HEIGHT-1;r>=0;r--){
      const i=r*WIDTH+c;
      if(board[i])col.push(board[i]);
    }
    while(col.length<HEIGHT)col.push({src:pool[Math.floor(Math.random()*pool.length)]});
    for(let r=HEIGHT-1;r>=0;r--)board[r*WIDTH+c]=col[HEIGHT-1-r];
  }
  render();
  const newMatches=findMatches();
  if(newMatches.length>0)setTimeout(()=>handleMatches(newMatches),200);
  else combo=1;
}

function updateHUD(){
  document.getElementById('score').textContent=score;
  document.getElementById('moves').textContent=moves;
  document.getElementById('combo').textContent=combo+'x';
  if(moves<=0)alert("üèÜ Game Over!\nYour Score: "+score);
}

document.getElementById('restartBtn').onclick=()=>initGame();
document.getElementById('hintBtn').onclick=()=>{
  const m=findMatches();
  if(m.length>0)document.querySelector(`[data-index="${m[0]}"]`).style.transform='scale(1.2)';
  setTimeout(()=>render(),1000);
};

preload();
</script>
</body>
</html>
