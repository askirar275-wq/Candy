<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Candy Match ‚Äî Game</title>

  <!-- ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ CSS ‡§´‡§æ‡§á‡§≤‡•á‡§Ç (‡§ú‡§∞‡•Ç‡§∞‡•Ä) -->
  <link rel="stylesheet" href="css/home.css">
  <link rel="stylesheet" href="css/game.css">
  <link rel="stylesheet" href="css/inventory.css">

  <!-- ‡§õ‡•ã‡§ü‡§æ fallback (‡§Ö‡§ó‡§∞ ‡§ï‡•ã‡§à css ‡§® ‡§Æ‡§ø‡§≤‡•á) -->
  <style>
    body{ margin:0; font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:#ffeaf0; }
  </style>
</head>
<body>
  <!-- Topbar -->
  <header style="padding:14px 12px; background:linear-gradient(180deg,#ffdce6,#ffd1e0); display:flex; align-items:center; gap:12px;">
    <button id="backBtn" style="background:#ffdff0;border:0;padding:8px 10px;border-radius:10px;">‚¨ÖÔ∏è Home</button>
    <div style="font-weight:700; font-size:20px; margin-left:6px;">Score: <span id="score">0</span></div>
    <div style="margin-left:auto; display:flex; gap:12px; align-items:center;">
      <div style="background:#fff;padding:8px 12px;border-radius:16px;">Coins: <span id="coins">0</span></div>
      <div id="levelBadge" style="background:#fff5;padding:6px 10px;border-radius:12px;font-weight:700;">Level: <span id="currentLevel">1</span></div>
    </div>
  </header>

  <!-- Game board container -->
  <main style="padding:18px;">
    <div id="game-wrapper" style="max-width:900px;margin:0 auto;">
      <div id="game-board" aria-live="polite"></div>

      <div style="display:flex;justify-content:center;gap:18px;margin-top:18px;">
        <button id="restartBtn" class="ui-btn">Restart</button>
        <button id="shuffleBtn" class="ui-btn">Shuffle</button>
        <button id="openShopBtn" class="ui-btn">Shop</button>
      </div>
    </div>

    <!-- Shop Modal (simple) -->
    <div id="shopModal" role="dialog" aria-hidden="true" style="display:none; position:fixed; inset:0; align-items:center; justify-content:center; background:rgba(0,0,0,0.35); z-index:9998;">
      <div style="background:#fff; border-radius:12px; padding:14px; width:92%; max-width:420px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3 style="margin:0">üõí Shop</h3>
          <div style="font-size:12px;color:#666">Coins: <span id="shopCoins">0</span></div>
        </div>
        <div style="margin-top:12px; display:grid; grid-template-columns:1fr 1fr; gap:8px;">
          <div class="shop-item">Bomb <div>‚Çπ200</div><button id="buyBomb">Buy</button></div>
          <div class="shop-item">Shuffle <div>‚Çπ100</div><button id="buyShuffle">Buy</button></div>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-top:12px;"><button id="closeShop">Close</button></div>
      </div>
    </div>

    <!-- Level up modal -->
    <div id="levelUpModal" style="display:none; position:fixed; inset:0; align-items:center; justify-content:center; background:rgba(0,0,0,0.5); z-index:9999;">
      <div style="background:#fff; padding:18px; border-radius:12px; width:90%; max-width:420px; text-align:center;">
        <h2 id="levelUpTitle">Level Up!</h2>
        <p id="levelUpText">Congrats ‚Äî next level unlocked.</p>
        <div style="margin-top:12px;"><button id="levelUpClose">Continue</button></div>
      </div>
    </div>

  </main>

  <!-- ===== Eruda (mobile console) - optional but helpful ===== -->
  <script>
    (function () {
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/eruda';
      s.onload = function () {
        try { eruda.init(); console.log('üêû Eruda console loaded'); } catch(e){ console.warn('Eruda load failed', e); }
      };
      document.body.appendChild(s);
    })();
  </script>

  <!-- Safe UI loader (single place) - ensures elements exist before calling game functions -->
  <script>
    (function(){
      function $id(id){ return document.getElementById(id); }
      function safeAdd(id, evt, h){ var el=$id(id); if(!el){ console.warn('safe-ui: missing #' + id); return; } el.addEventListener(evt,h); }

      document.addEventListener('DOMContentLoaded', function(){
        console.log('‚úÖ Safe UI loaded');

        safeAdd('restartBtn','click', () => { if(typeof restartGame === 'function') restartGame(); else console.warn('restartGame missing'); });
        safeAdd('shuffleBtn','click', () => { if(typeof shuffleBoard === 'function') shuffleBoard(); else console.warn('shuffleBoard missing'); });

        // shop open/close
        function openShop(){ var m=$id('shopModal'); if(m){ m.style.display='flex'; m.setAttribute('aria-hidden','false'); } else console.warn('shopModal not found'); }
        safeAdd('openShopBtn','click', openShop);
        safeAdd('shopBtn','click', openShop);
        safeAdd('closeShop','click', function(){ var m=$id('shopModal'); if(m){ m.style.display='none'; m.setAttribute('aria-hidden','true'); } });

        // start/back buttons - if you have a home-screen flow, connect them here
        safeAdd('backBtn','click', function(){
          // optional: go to home page or show map
          console.log('Back button clicked');
        });

        safeAdd('levelUpClose','click', function(){ var m=$id('levelUpModal'); if(m) m.style.display='none'; });
      });
    })();
  </script>

  <!-- Required game scripts: storage first (if you have one), then game.js -->
  <script src="js/storage.js"></script>
  <script src="js/game.js"></script>

  <!-- safety: if game didn't load initGame automatically, Safe UI can call it from console with initGame() -->
</body>
</html>
