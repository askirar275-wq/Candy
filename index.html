<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Candy Match üç¨</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/home.css">
  <link rel="stylesheet" href="css/game.css">
  <link rel="stylesheet" href="css/inventory.css"> <!-- ‡§Ü‡§™‡§®‡•á ‡§¨‡§®‡§æ ‡§∞‡§ñ‡§æ ‡§•‡§æ -->

  <style>
    /* ‡§õ‡•ã‡§ü‡§æ fallback style ‡§§‡§æ‡§ï‡§ø board center ‡§¶‡§ø‡§ñ‡•á ‡§Ö‡§ó‡§∞ ‡§ï‡§ø‡§∏‡•Ä CSS ‡§Æ‡§ø‡§∏ ‡§π‡•ã */
    body { margin:0; font-family: system-ui, Arial, sans-serif; }
    .screen { display:none; }
    .screen.active { display:block; }
  </style>
</head>
<body>
  <!-- HOME -->
  <div id="home-screen" class="screen active">
    <img src="images/candy1.png" alt="logo" class="logo" style="width:110px;height:110px;display:block;margin:6px auto;">
    <h1 class="title">üç≠ Candy Match</h1>
    <p class="subtitle">‡§∏‡•ç‡§µ‡•Ä‡§ü ‡§ó‡•á‡§Æ ‡§è‡§°‡§µ‡•á‡§Ç‡§ö‡§∞ ‚Äî ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§´‡•ç‡§∞‡•á‡§Ç‡§°‡§≤‡•Ä</p>

    <div class="buttons" style="display:flex;flex-direction:column;gap:10px;align-items:center;margin-top:12px;">
      <button id="startBtn" style="width:80%;padding:12px;border-radius:12px;">üéÆ Start</button>
      <button id="shopBtn" style="width:80%;padding:12px;border-radius:12px;">üõí Shop</button>
      <button id="settingsBtn" style="width:80%;padding:12px;border-radius:12px;">‚öôÔ∏è Settings</button>
    </div>

    <button id="installBtn" class="install" style="margin-top:12px;padding:8px 14px;border-radius:10px;">‚¨áÔ∏è Install</button>
    <p class="footer" style="margin-top:12px;color:#666">Made with ‚ù§Ô∏è ‚Äî Arun App Studio</p>
  </div>

  <!-- GAME -->
  <div id="game-screen" class="screen">
    <div class="topbar" style="display:flex;align-items:center;gap:10px;padding:10px;">
      <button id="backBtn" style="padding:8px 10px;border-radius:8px;">‚¨ÖÔ∏è Home</button>
      <h2 style="margin:0">Score: <span id="score">0</span></h2>
      <div style="margin-left:auto" class="coins-bubble">Coins: <span id="coins">0</span></div>
    </div>

    <div id="game-board" class="board" style="display:grid;grid-template-columns:repeat(8,1fr);gap:6px;padding:8px;max-width:520px;margin:10px auto;">
      <!-- tiles will be rendered here by js/game.js -->
    </div>

    <div style="display:flex;justify-content:center;gap:8px;margin-top:14px;">
      <button id="restartBtn" style="padding:8px 12px;border-radius:8px;">Restart</button>
      <button id="shuffleBtn" style="padding:8px 12px;border-radius:8px;">Shuffle</button>
      <button id="openShopBtn" style="padding:8px 12px;border-radius:8px;">Open Shop</button>
    </div>
  </div>

  <!-- SHOP MODAL -->
  <div id="shopModal" class="shop-modal" role="dialog" aria-hidden="true" style="display:none;">
    <div class="shop-card">
      <div class="shop-top" style="display:flex;justify-content:space-between;align-items:center;">
        <div><h3 style="margin:0">üõí Shop</h3><div class="small-note">Coins ‡§∏‡•á power-ups ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç ‚Äî Demo</div></div>
        <div style="text-align:right"><div style="font-size:12px;color:#666">Your Coins</div><div class="coins-bubble" id="shopCoins">0</div></div>
      </div>
      <div class="shop-grid" style="margin-top:12px;">
        <div class="shop-item"><div style="font-size:20px">üí£ Bomb</div><div style="font-weight:800;margin-top:8px">‚Çπ 200</div><button id="buyBomb">Buy</button></div>
        <div class="shop-item"><div style="font-size:20px">üîÄ Shuffle</div><div style="font-weight:800;margin-top:8px">‚Çπ 100</div><button id="buyShuffle">Buy</button></div>
        <div class="shop-item"><div style="font-size:20px">‚ûï Extra Moves</div><div style="font-weight:800;margin-top:8px">‚Çπ 80</div><button id="buyMoves">Buy</button></div>
        <div class="shop-item"><div style="font-size:20px">‚ú® Rainbow Candy</div><div style="font-weight:800;margin-top:8px">‚Çπ 350</div><button id="buyRainbow">Buy</button></div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;"><button id="closeShop">Close</button></div>
    </div>
  </div>

  <!-- SCRIPTS - order important -->
  <!-- 1) home UI helpers (optional) -->
  <script src="js/home.js" defer></script>

  <!-- 2) core game logic MUST load before shop/inventory so initGame is available -->
  <script src="js/game.js" defer></script>

  <!-- 3) inventory & ui helpers -->
  <script src="js/inventory.js" defer></script>
  <script src="js/ui.js" defer></script>

  <!-- 4) shop (uses coins/inventory) -->
  <script src="js/shop.js" defer></script>

  <!-- 5) parallax / small helpers -->
  <script src="js/parallax.js" defer></script>

  <!-- 6) small inline wiring to ensure elements exist and to provide fallback -->
  <script>
    // safety: ensure DOM elements exist after load
    window.addEventListener('DOMContentLoaded', () => {
      // check required elements
      const startBtn = document.getElementById('startBtn');
      const shopBtn = document.getElementById('shopBtn');
      const backBtn  = document.getElementById('backBtn');
      const openShopBtn = document.getElementById('openShopBtn');
      const closeShop = document.getElementById('closeShop');

      function showScreen(which){
        const home = document.getElementById('home-screen');
        const game = document.getElementById('game-screen');
        if(which === 'home'){ home.classList.add('active'); game.classList.remove('active'); }
        else { game.classList.add('active'); home.classList.remove('active'); }
      }

      // fallback initGame if your game.js didn't expose it
      if(typeof window.initGame !== 'function'){
        window.initGame = function(){
          console.log('Fallback initGame running (simple board).');
          const board = document.getElementById('game-board');
          if(!board) return;
          board.innerHTML = '';
          const size = 6;
          for(let r=0;r<size;r++){
            for(let c=0;c<size;c++){
              const cell = document.createElement('div');
              cell.className = 'cell';
              cell.style.width = '48px';
              cell.style.height = '48px';
              const img = document.createElement('img');
              img.className = 'tile';
              img.src = 'images/candy1.png';
              cell.appendChild(img);
              board.appendChild(cell);
            }
          }
        };
      }

      // Start button
      if(startBtn){
        startBtn.addEventListener('click', () => {
          showScreen('game');
          try{
            if(typeof initGame === 'function') initGame();
            else console.warn('initGame not defined');
          }catch(e){ console.error(e); alert('Game init failed: see console'); }
        });
      } else console.warn('startBtn not found in DOM');

      // Shop open handlers
      function openShop(){
        const modal = document.getElementById('shopModal');
        if(!modal) return console.warn('shopModal not found');
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden','false');
      }
      function closeShopFn(){
        const modal = document.getElementById('shopModal');
        if(!modal) return;
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden','true');
      }

      if(shopBtn) shopBtn.addEventListener('click', openShop);
      if(openShopBtn) openShopBtn.addEventListener('click', openShop);
      if(closeShop) closeShop.addEventListener('click', closeShopFn);
      if(backBtn) backBtn.addEventListener('click', ()=> showScreen('home'));

      // expose for console debug
      window.showScreen = showScreen;
      window.openShop = openShop;
      window.closeShop = closeShopFn;
    });
  </script>

  <!-- Debug mobile console (optional) -->
  <script>
    // Debug mode ‚Äî remove in production
    const DEBUG_MODE = true;
    if (DEBUG_MODE) {
      const s = document.createElement("script");
      s.src = "https://cdn.jsdelivr.net/npm/eruda";
      s.onload = () => { eruda.init(); console.log("Eruda started"); };
      document.body.appendChild(s);
    }
  </script>
</body>
        </html>
