<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="google" content="notranslate" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Candy Match — Level Map</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <main class="container">
    <section class="card" aria-labelledby="mapTitle">
      <a class="btn back" href="index.html" style="display:inline-block;margin-bottom:10px;">← Back</a>
      <h2 id="mapTitle" style="margin-top:6px;">Level Map</h2>

      <p class="lead" style="margin-top:6px;">Choose a level to play. Complete levels unlock the next one.</p>

      <div style="display:flex;gap:10px;align-items:center;margin-top:8px;">
        <button id="resetProgress" class="btn secondary" style="padding:8px 12px;">Reset Progress</button>
        <small style="color:#666;">Progress saved in your browser (localStorage).</small>
      </div>

      <div id="levelGrid" class="level-grid" style="margin-top:18px;"></div>
    </section>
  </main>

  <script src="js/storage.js"></script>
  <script>
    (function(){
      const TOTAL = 9;
      const gridEl = document.getElementById('levelGrid');

      function render(){
        const prog = Storage.getProgress();
        gridEl.innerHTML = '';
        for(let i=1;i<=TOTAL;i++){
          const card = document.createElement('div');
          card.className = 'level-card' + (prog.unlocked.includes(i) ? '' : ' locked');

          const thumb = document.createElement('div');
          thumb.className = 'level-thumb';
          for(let j=0;j<3;j++){
            const img = document.createElement('img');
            img.src = `images/candy${(i+j) % 5 + 1}.png`;
            img.alt = 'candy';
            thumb.appendChild(img);
          }

          const label = document.createElement('div');
          label.className = 'label';
          label.textContent = prog.unlocked.includes(i) ? `Level ${i} • Play` : `Level ${i} • Locked`;

          card.appendChild(thumb);
          card.appendChild(label);

          (function(level){
            card.addEventListener('click', ()=>{
              if(!prog.unlocked.includes(level)){
                alert('This level is locked. Complete previous levels to unlock.');
                return;
              }
              location.href = `game.html?level=${level}`;
            });
          })(i);

          gridEl.appendChild(card);
        }
      }

      document.getElementById('resetProgress').addEventListener('click', ()=>{
        if(confirm('Reset all progress?')){
          Storage.reset();
          render();
        }
      });

      // initial render
      render();
    })();
  </script>
</body>
</html>
